## link

https://www.cnblogs.com/kismetv/p/10787228.html



## 乐观锁与悲观锁

乐观锁和悲观锁是两种思想，用于解决并发场景下的数据竞争问题。

乐观锁：在修改数据时，认为别人不会同时修改数据，不加实际的锁，在执行更新时判断是否有人修改了数据，如果有修改则放弃操作，否则执行操作。

悲观锁：在修改数据时直接把数据锁住，直到操作完成后才会释放锁，上锁期间其他人不能修改数据。

悲观锁的实现可以是对代码块加锁，也可以是对数据加锁。



乐观锁的实现方式主要有两种：CAS机制和版本号机制。

compare and swap

修改数据时判断一下数据的值是否等于预期的值，如果符合预期则将值改为新值，否则不进行任何 操作。 ABA问题，CAS一直失败重试带来CPU开销过大

版本号机制

在数据中加一个字符version，表示数据的版本，每当数据被修改，版本号加1，某相线程查询数据时，将数据的版本号一起查出来，更新数据时，判断当前版本号与之前读取的版本号是否一致