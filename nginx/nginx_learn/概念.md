Nginx是什么？

nginx是一款高性能的HTTP服务器和反向代理服务器。nginx是开源的。

nginx本身可以托管网站，进行http服务处理；也可以作为反向代理服务器使用。

nginx解决了服务器的C10K（即在一秒内客户端连接的数量为10k）问题。使用了异步事件驱动机制。

正向代理与反向代理

我们一般提到的代理服务器是作用在客户端，指局域网内部的机器通过代理服务器将请求发送到互联网上的服务器。例如我们的客户端在进行翻墙时使用的是正向代理。

反向代理服务器作用在服务端，它接收客户端的请求，然后将请求分发给具体的服务器，然后将服务器的结果返回给客户端。nginx就是一个反向代理服务器软件。

防火墙的作用是什么？

nginx的特点

* 跨平台
* 配置简单
* 非阻塞，高并发连接
* master/worker多进程工作模式
* 内存消耗小

多进程的工作方式

nginx在启动后，会有一个master进程和多个worker进程。master进程主要负责管理worker进程，包括：接收来自外界的信号，向各worker进程发送信号，监控woker进程的运行状态，当worker进程异常退出后，自动启动新的worker进程。

基本的网络事件，是放在woker进程中处理的，woker之间的关系是对等的，他们共同竞争来自客户端的请求，各进程之间是相互独立的，互不影响。一个请求只在一个worker中处理。worker的数量一般配置为与机器CPU核数一致。

处理请求

nginx在启动时，首先会解析配置文件，读取监听的端口与IP地址，然后 在master进程里初始化这个监听的socket（创建socket，设置addrreuse等选项，绑定到指定的IP地址端口，再listen）最后再fork出多个子进程出来，子进程会竞争accept新的连接。

客户端向nginx发起连接，与nginx进行三次握手，建立连接后，nginx某个子进程会accept成功，创建一个建立好连接的socket，再创建对连接的封装，即ngx_connection结构体。接着，设置读写事件处理函数并添加读写事件进行数据交换。最后，nginx或客户端关闭连接，一个连接的生命周期结束。

四层负载均衡与七层负载均衡